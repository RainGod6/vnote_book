# 01-协程的概念


协程，又称微线程，纤程。英文名Coroutine，是一种用户态的轻量级线程。

子程序，或者称为函数，在所有语言中都是层级调用，比如A调用B，B在执行过程中又调用里C，C执行完毕返回，B执行完毕返回，最后A执行完毕。所以子程序调用是通过栈实现的，一个线程就是执行一个子程序。子程序调用总是一个入口，一次返回，调用顺序是明确的。而协程的调用和子程序不同。


线程是系统级别的他们由操作系统调度，而协程则是程序级别的由程序根据自己需要自己调度。在一恶搞线程中会有很多函数，我们把这些函数称为子程序，在子程序执行过程中可以中断去执行别的子程序，而别的子程序也可以中断回来继续执行之前的子程序，这个过程就称为协程。也就是说在同一线程内一段代码在执行过程中会断然后跳转执行别的代码，接着在之前中断的地方继续开始执行。


协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈。因此：协程能保留上一次调用时的状态（即所有局部状态的一个特定组合），每次过程重入时，就相当于进入上一次调用的状态，换种说法：进入上一次离开时所处逻辑流的位置。





**协程的优点：**

-  无需线程上下文切换的开销，协程避免了无意义的调度，由此可以提高性能（但也因此，程序员必须自己承担调度的责任），同时，协程也失去了标准线程使用多CPU的能力。
- 无需原子操作锁定及同步的开销
- 方便切换控制流，简化变成模型
- 高并发+高扩展性+低成本：一个CPU支持上万的协程都不是问题。所以很适合用于高并发处理。


**协程的缺点：**

- 无法利用多核资源：协程的本质是个单线程，他不能同时将单个CPU的多个核用上，协程需要和进程配合才能运行在多CPU上，当然我们日常所编写的绝大部分应用都没有这个必要，除非是cpu密集型应用。
- 进行阻塞（blocking）操作（如IO时）会阻塞掉整个程序。


